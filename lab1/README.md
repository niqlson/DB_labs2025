# Онлайн магазин - Аналіз ER діаграми

## 1. Вимоги:

### Призначення системи:
    Має бути спроєктована база даних для магазину 
### Потреби зацікавлених сторін:
- **Покупці**: Пошук бажаних товарів, їх збереження та покупка.
- **Продавець**: Управління наявними товарами, відстеження замовлень

### Дані для зберігання:
- Інформація про наявні товари
- Дані про замовлення - статус, ціна, товар в замовлені ...
- Інформація про наявних користувачів, іх персональні дані та ролі
- Інформація про наявні знижки - ціна знижки, час початку та кінця дії
- Дані про відгуки на товари
- Кошики користувачів - предмети, що входять до них.

### Бізнес-правила:
- При замовленні кількість товару в корзині не має перевищувати наявну кількість товару.
- Рейтинг продукту обчислюється на основі отриманих відгуків від покупців.
- Кожен продукт може мати тільки одну активну знижку.
- Не можна зареєструвати акаунт, якщо в системі існує користувач із такою самою поштою.
- Кожне замовлення повино мати статус та змінюватися залежно від стадії обробки
- При оформлені кожного замовленя бронются певна кількість певного товару

## 2. Список сутностей з атрибутами та пояснення зв'язків

### Сутності:

## User (Користувач)
- **id** (PK): Унікальний ідентифікатор користувача
- **email**: Електронна пошта (унікальна, обов'язкова)
- **firstName**: Ім'я користувача (обов'язкове)
- **lastName**: Прізвище користувача (обов'язкове)
- **verified**: Статус верифікації облікового запису (обов'язкове)
- **blocked**: Статус блокування облікового запису (обов'язкове)
- **role**: Роль користувача в системі (обов'язкове)
- **password**: Хеш пароля (обов'язкове)
- **created_at**: Дата створення облікового запису
- **updated_at**: Дата останнього оновлення

## Product (Товар)
- **id** (PK): Унікальний ідентифікатор товару
- **name**: Назва товару (обов'язкове)
- **image_url**: URL зображення товару (обов'язкове)
- **description**: Опис товару
- **available_quantity**: Доступна кількість на складі (обов'язкове)
- **price**: Ціна товару (обов'язкове)
- **enabled**: Статус активності товару (обов'язкове)
- **created_at**: Дата додавання товару
- **updated_at**: Дата останнього оновлення

## Discount (Знижка)
- **id** (PK): Унікальний ідентифікатор знижки
- **product_id** (FK): Посилання на товар (обов'язкове)
- **discount_value**: Розмір знижки (обов'язкове)
- **start_date**: Дата початку дії знижки (обов'язкове)
- **end_date**: Дата закінчення дії знижки (обов'язкове)
- **enabled**: Статус активності знижки (обов'язкове)
- **created_at**: Дата створення знижки
- **updated_at**: Дата останнього оновлення

## Review (Відгук)
- **id** (PK): Унікальний ідентифікатор відгуку
- **product_id** (FK): Посилання на товар (обов'язкове)
- **user_id** (FK): Посилання на користувача (обов'язкове)
- **rating**: Оцінка товару (1-5, обов'язкове)
- **text**: Текст відгуку (обов'язкове)
- **created_at**: Дата створення відгуку

## Cart (Кошик)
- **id** (PK): Унікальний ідентифікатор кошика
- **user_id** (FK): Посилання на користувача (обов'язкове)
- **created_at**: Дата створення кошика
- **updated_at**: Дата останнього оновлення

## Cart Item (Елемент кошика)
- **id** (PK): Унікальний ідентифікатор елемента кошика
- **product_id** (FK): Посилання на товар (обов'язкове)
- **cart_id** (FK): Посилання на кошик (обов'язкове)
- **quantity**: Кількість товару (обов'язкове)

## Order (Замовлення)
- **id** (PK): Унікальний ідентифікатор замовлення
- **user_id** (FK): Посилання на користувача (обов'язкове)
- **phone_number**: Номер телефону отримувача (обов'язкове)
- **city**: Місто доставки (обов'язкове)
- **delivery_price**: Вартість доставки (обов'язкове)
- **totalPrice**: Загальна сума замовлення (обов'язкове)
- **postal_code**: Поштовий індекс (обов'язкове)
- **comment**: Коментар до замовлення
- **payment_type**: Тип оплати (CARD, CASH, обов'язкове)
- **status**: Статус замовлення (обов'язкове)
- **delivery_type**: Тип доставки (обов'язкове)
- **created_at**: Дата створення замовлення
- **updated_at**: Дата останнього оновлення

## Order Item (Елемент замовлення)
- **id** (PK): Унікальний ідентифікатор елемента замовлення
- **product_id** (FK): Посилання на товар (обов'язкове)
- **order_id** (FK): Посилання на замовлення (обов'язкове)
- **quantity**: Кількість товару (обов'язкове)
- **price**: Ціна товару на момент замовлення (обов'язкове)

## Reservation (Резервація)
- **id** (PK): Унікальний ідентифікатор резервації
- **order_id** (FK): Посилання на замовлення (обов'язкове)
- **status**: Статус резервації (PENDING, CONFIRMED, CANCELED, COMPLETED)
- **created_at**: Дата створення резервації
- **updated_at**: Дата останнього оновлення

## Reservation Item (Елемент резервації)
- **id** (PK): Унікальний ідентифікатор елемента резервації
- **product_id** (FK): Посилання на товар (обов'язкове)
- **reservation_id** (FK): Посилання на резервацію (обов'язкове)
- **quantity**: Зарезервована кількість товару (обов'язкове)


### Пояснення зв'язків:

## 1. **User → Cart (1:1)**
Один користувач може мати один кошик. Зв'язок через `user_id` як зовнішній ключ в таблиці `carts`.

## 2. **User → Order (1:N)**
Один користувач може мати багато замовлень. Зв'язок через `user_id` як зовнішній ключ в таблиці `orders`.

## 3. **User → Review (1:N)**
Один користувач може залишити багато відгуків. Зв'язок через `user_id` як зовнішній ключ в таблиці `reviews`.

## 4. **Product → Discount (1:N)**
Один товар може мати багато знижок (в різний час). Зв'язок через `product_id` як зовнішній ключ в таблиці `discount`.

## 5. **Product → Review (1:N)**
Один товар може мати багато відгуків від різних користувачів. Зв'язок через `product_id` як зовнішній ключ в таблиці `reviews`.

## 6. **Product → Cart Item (1:N)**
Один товар може бути доданий у багато кошиків різних користувачів. Зв'язок через `product_id` як зовнішній ключ в таблиці `cart_items`.

## 7. **Product → Order Item (1:N)**
Один товар може входити до складу багатьох замовлень. Зв'язок через `product_id` як зовнішній ключ в таблиці `order_items`.

## 8. **Product → Reservation Item (1:N)**
Один товар може бути зарезервований у багатьох резерваціях. Зв'язок через `product_id` як зовнішній ключ в таблиці `reservation_items`.

## 9. **Cart → Cart Item (1:N)**
Один кошик може містити багато товарів. Зв'язок через `cart_id` як зовнішній ключ в таблиці `cart_items`.

## 10. **Order → Order Item (1:N)**
Одне замовлення може містити багато товарів. Зв'язок через `order_id` як зовнішній ключ в таблиці `order_items`.

## 11. **Order → Reservation (1:1)**
Одне замовлення може мати одну резервацію товарів. Зв'язок через `order_id` як зовнішній ключ в таблиці `reservations`.

## 12. **Reservation → Reservation Item (1:N)**
Одна резервація може містити багато товарів. Зв'язок через `reservation_id` як зовнішній ключ в таблиці `reservation_items`.

## Many-to-Many Relationships (N:N)

### **User ↔ Product (через Reviews)**
Користувачі можуть залишати відгуки на багато товарів, а товари можуть мати відгуки від багатьох користувачів. Реалізовано через таблицю `reviews`.

### **User ↔ Product (через Cart Items)**
Користувачі можуть додавати багато товарів у кошик, а товари можуть бути у кошиках багатьох користувачів. Реалізовано через таблиці `carts` та `cart_items`.

### **User ↔ Product (через Order Items)**
Користувачі можуть купувати багато товарів, а товари можуть бути куплені багатьма користувачами. Реалізовано через таблиці `orders` та `order_items`.

### **User ↔ Product (через Reservation Items)**
Користувачі можуть резервувати багато товарів, а товари можуть бути зарезервовані багатьма користувачами. Реалізовано через таблиці `orders`, `reservations` та `reservation_items`.

## 3. Обмеження

### Обмеження:
1. **Рейтинг товару**: Обмежений діапазоном 0.00-5.00
2. **Наявна кількість товару**: не може бути від'ємною
3. **Кількість активних знижок для товару**: може бути тільки одна активна знижка на товар
4. **Відгуки**: доступно тільки для клієнтів, які купили товар
5. **Обов'язкові поля**: Email аккаунту має бути унікальним
6. **Статуси замовлень**: CREATED, CONFIRMED, PROCESSING, SHIPPED, READY_FOR_PICKUP, COMPLETED, CANCELLED, RETURNED;
7. **Типи оплати**: Карткою або готівкою
8. **Типи доставки**:  SELF_PICKUP, EXPRESS_DELIVERY, COURIER;
9. **Ролі користувача**: Користувач може бути або Customer, або Admin.